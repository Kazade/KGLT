CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
PROJECT(kglt)

# Set module options
OPTION(KGLT_BUILD_TESTS "Build KGLT tests" ON)
OPTION(KGLT_BUILD_SAMPLES "Build KGLT samples" ON)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_SOURCE_DIR}/cmake_modules/")
INCLUDE(cotire)

if(${CMAKE_CURRENT_SOURCE_DIR} MATCHES ${CMAKE_SOURCE_DIR})
    SET (CMAKE_C_COMPILER "/usr/bin/clang")
    SET (CMAKE_CXX_COMPILER "/usr/bin/clang++")
ENDIF(${CMAKE_CURRENT_SOURCE_DIR} MATCHES ${CMAKE_SOURCE_DIR})


FIND_PACKAGE(PkgConfig REQUIRED)

FIND_PACKAGE(KAZTEST)
FIND_PACKAGE(KAZBASE REQUIRED)
FIND_PACKAGE(KAZMATH REQUIRED)
FIND_PACKAGE(KAZTIMER REQUIRED)
FIND_PACKAGE(SOIL REQUIRED)
FIND_PACKAGE(OpenAL REQUIRED)
FIND_PACKAGE(Lua51 REQUIRED)

ADD_DEFINITIONS("-Wall -g -Wno-mismatched-tags -DdSINGLE")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -pthread")
#ADD_DEFINITIONS("-DBOOST_NO_RVALUE_REFERENCES") #https://svn.boost.org/trac/boost/ticket/4521

PKG_CHECK_MODULES(SDL2 sdl2 REQUIRED)
PKG_CHECK_MODULES(GL gl REQUIRED)
PKG_CHECK_MODULES(ODE REQUIRED ode)

FIND_PACKAGE(Boost COMPONENTS thread chrono system date_time regex REQUIRED)
FIND_PACKAGE(Freetype REQUIRED)
FIND_PACKAGE(GLEW REQUIRED)

FILE(COPY ${CMAKE_CURRENT_SOURCE_DIR}/kglt/materials DESTINATION ${CMAKE_BINARY_DIR}/kglt)
FILE(COPY ${CMAKE_CURRENT_SOURCE_DIR}/kglt/fonts DESTINATION ${CMAKE_BINARY_DIR}/kglt)

INCLUDE_DIRECTORIES(
    ${CMAKE_CURRENT_SOURCE_DIR}/kglt/ui/rocket/Include #libRocket`
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${KAZBASE_INCLUDE_DIRS}
    ${KAZMATH_INCLUDE_DIRS}
    ${KAZTIMER_INCLUDE_DIRS}
    ${SDL2_INCLUDE_DIRS}
    ${GL_INCLUDE_DIRS}
    ${SOIL_INCLUDE_DIRS}
    ${FREETYPE_INCLUDE_DIRS}
    ${OPENAL_INCLUDE_DIRS}
    ${LUA_INCLUDE_DIR}
    ${ODE_INCLUDE_DIRS}
    ${GLEW_INCLUDE_DIR}
)

LINK_LIBRARIES(
    ${SDL2_LIBRARIES}
    ${GL_LIBRARIES}
    ${SOIL_LIBRARIES}
    ${KAZBASE_LIBRARIES}
    ${KAZTIMER_LIBRARIES}
    ${KAZMATH_LIBRARIES}
    ${Boost_SYSTEM_LIBRARY}
    ${Boost_DATE_TIME_LIBRARY}
    ${Boost_REGEX_LIBRARY}
    ${Boost_CHRONO_LIBRARY}
    ${Boost_THREAD_LIBRARY}
    ${FREETYPE_LIBRARY}
    ${OPENAL_LIBRARY}
    ${LUA_LIBRARIES}
    ${ODE_LIBRARIES}
    ${GLEW_LIBRARIES}
    rt
)

ADD_SUBDIRECTORY(submodules)

INCLUDE_DIRECTORIES(submodules/luabind)
LINK_LIBRARIES(luabind)

ADD_SUBDIRECTORY(kglt)
IF(KAZTEST_FOUND)
    ADD_SUBDIRECTORY(tests)
ENDIF()
IF(KGLT_BUILD_SAMPLES)
    ADD_SUBDIRECTORY(samples)
ENDIF(KGLT_BUILD_SAMPLES)


INSTALL(FILES ${CMAKE_SOURCE_DIR}/kglt/kazbase/bin/gen_tests.py DESTINATION ${CMAKE_INSTALL_PREFIX}/bin PERMISSIONS GROUP_EXECUTE WORLD_READ WORLD_EXECUTE RENAME kglt_gen_tests.py)


