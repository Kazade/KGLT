FILE(GLOB TEST_FILES *.h)
FILE(GLOB TEST_SOURCES global.cpp)
FILE(GLOB LIBGL_CONTAINERS ${CMAKE_SOURCE_DIR}/deps/libgl/containers/*.c)

IF(SIMULANT_GL_VERSION_1X)
FILE(GLOB GL_TESTS gl1/*.h)
ELSE()
FILE(GLOB GL_TESTS gl2/*.h)
ENDIF()

INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/deps/kaztest)

SET(KAZTEST_EXECUTABLE ${CMAKE_SOURCE_DIR}/deps/kaztest/bin/kaztest_gen)

IF(DREAMCAST_BUILD)
SET(TEST_MAIN_FILENAME main-dc.cpp)
ELSE()
SET(TEST_MAIN_FILENAME main.cpp)
ENDIF()

ADD_CUSTOM_COMMAND(
    OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/${TEST_MAIN_FILENAME}
    COMMAND ${KAZTEST_EXECUTABLE} --output ${CMAKE_CURRENT_SOURCE_DIR}/${TEST_MAIN_FILENAME} ${TEST_FILES} ${GL_TESTS}
    DEPENDS ${TEST_FILES} ${GL_TESTS} ${KAZTEST_EXECUTABLE}
)

ADD_EXECUTABLE(simulant_tests ${TEST_FILES} ${TEST_SOURCES} ${LIBGL_CONTAINERS} ${CMAKE_CURRENT_SOURCE_DIR}/${TEST_MAIN_FILENAME})
ADD_TEST(simulant_suite simulant_tests)

TARGET_LINK_LIBRARIES(
    simulant_tests
    simulant
)

